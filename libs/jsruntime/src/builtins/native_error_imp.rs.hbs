// DO NOT EDIT THIS FILE BY HAND.
//
// This file was automagically generated with:
// template: {{@template}}

//$id {{id}}
//$class {{class}}
//$inherits error

use jsparser::Symbol;

use crate::Error;
use crate::Runtime;
use crate::logger;
use crate::types::CallContext;
use crate::types::ObjectHandle;
use crate::types::Property;
use crate::types::StringHandle;
use crate::types::Value;

//#sec-nativeerror constructor
pub fn constructor<X>(runtime: &mut Runtime<X>, context: &mut CallContext) -> Result<Value, Error> {
    logger::debug!(event = "{{id}}_constructor");
    let args = context.args();

    // TODO(feat): NewTarget
    if !context.is_new() {
        return Err(Error::InternalError);
    }

    let mut object = if let Value::Object(this) = context.this() {
        *this
    } else {
        runtime.create_object(runtime.{{id}}_prototype)
    };
    object.set_error();

    match args.first().unwrap_or(&Value::Undefined) {
        Value::Undefined => (),
        message => {
            let msg = runtime.value_to_string(message)?;
            // TODO: error handling
            let _ = object.define_own_property(
                Symbol::MESSAGE.into(),
                Property::data_wxc(Value::String(msg)),
            );
        }
    }

    if let Value::Object(value) = args.get(1).unwrap_or(&Value::Undefined) {
        let key = Symbol::CAUSE.into();
        if let Some(value) = value.get_value(&key) {
            // TODO: error handling
            let _ = object.define_own_property(key, Property::data_wxc(value.clone()));
        }
    }

    Ok(Value::Object(object))
}

//#sec-nativeerror.prototype.message prototype.property
pub fn {{id}}_prototype_message<X>(_runtime: &mut Runtime<X>, mut prototype: ObjectHandle) {
    let _ = prototype.define_own_property(
        Symbol::MESSAGE.into(),
        Property::data_xxx(Value::String(StringHandle::EMPTY)),
    );
}

//#sec-nativeerror.prototype.name prototype.property
pub fn {{id}}_prototype_name<X>(_runtime: &mut Runtime<X>, mut prototype: ObjectHandle) {
    let _ = prototype.define_own_property(
        Symbol::NAME.into(),
        Property::data_xxx(Value::String(const_string!("{{class}}"))),
    );
}

impl<X> Runtime<X> {
    #[allow(unused)]
    pub(crate) fn create_{{id}}(&mut self, msg: Option<StringHandle>) -> ObjectHandle {
        let mut object = self.create_object(self.{{id}}_prototype);
        if let Some(msg) = msg {
            let _ = object.define_own_property(
                Symbol::MESSAGE.into(),
                Property::data_wxc(Value::String(msg)),
            );
        }
        object
    }
}
