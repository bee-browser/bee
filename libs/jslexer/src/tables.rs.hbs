// DO NOT EDIT THIS FILE BY HAND.
//
// This file was automagically generated by:
// {{@command}}

#[derive(Clone, Copy, Debug, PartialEq)]
pub enum Token {
    {{#each tokens}}
    {{pascalCase name}},
    {{/each}}
    Eof,
}

#[derive(Clone, Copy, Debug)]
pub struct CharClass(u8);

impl TryFrom<char> for CharClass {
    type Error = ();

    fn try_from(ch: char) -> Result<Self, Self::Error> {
        let c = ch as usize;
        if c < 128 {
            return Ok(CharClass(ASCII_TABLE[c]));
        }
        {{#each ccNonAsciiList}}
        {{#if codePoint}}
        if c == {{codePoint}} {
            return Ok(CharClass({{charClass}}));
        }
        {{else}}
        if c >= {{firstCodePoint}} && c <= {{lastCodePoint}} {
            return Ok(CharClass({{charClass}}));
        }
        {{/if}}
        {{/each}}
        Err(())
    }
}

const ASCII_TABLE: [u8; 128] = {{json ccAsciiTable}};

#[derive(Clone, Copy, Debug, Default)]
pub struct State(u16);

impl State {
    #[inline(always)]
    pub fn next_state(self, cc: CharClass) -> State {
        State(TRANSITION_TABLE[self.0 as usize][cc.0 as usize])
    }

    #[inline(always)]
    pub fn accept(self) -> Option<Token> {
        ACCEPT_TABLE[self.0 as usize]
    }
}

const TRANSITION_TABLE: [[u16; {{length charClasses}}]; {{length states}}] = [
    {{#each states}}
    {{json transitions}},
    {{/each}}
];

const ACCEPT_TABLE: [Option<Token>; {{length states}}] = [
    {{#each states}}
    {{#if accept}}
    Some(Token::{{pascalCase accept.name}}),
    {{else}}
    None,
    {{/if}}
    {{/each}}
];
