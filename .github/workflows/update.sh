WORKFLOWS_DIR="$PROJDIR/.github/workflows"
TEMPLATES_DIR="$WORKFLOWS_DIR/templates"

HEADER=$(cat <<EOF
# DO NOT EDIT THIS FILE BY HAND.
#
# This file was generated by $PROGNAME automagically.
EOF
)

cat <<EOF >$WORKFLOWS_DIR/ci.yml
$HEADER
$(bee-tools-deepmerge --format yaml \
    $TEMPLATES_DIR/ci.workflow.yml \
    $TEMPLATES_DIR/build.job.yml \
    $TEMPLATES_DIR/coverage.job.yml)
EOF

# cat <<EOF >$WORKFLOWS_DIR/release.yml
# $HEADER
# $(bee-deepmerge --format yaml \
#     $TEMPLATES_DIR/release.workflow.yml)
# EOF

cat <<EOF >$WORKFLOWS_DIR/pull-request.yml
$HEADER
$(bee-tools-deepmerge --format yaml \
    $TEMPLATES_DIR/pull-request.workflow.yml \
    $TEMPLATES_DIR/build.job.yml \
    $TEMPLATES_DIR/coverage.job.yml \
    $TEMPLATES_DIR/auto-merge.job.yml)
EOF
