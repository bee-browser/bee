// DO NOT EDIT THIS FILE BY HAND.
//
// This file was automagically generated with:
// template: {{ template }}

use jsparser::Symbol;

use crate::Runtime;
use crate::U16Chunk;
use crate::U16String;
use crate::logger;
use crate::objects::ObjectHandle;
use crate::objects::Property;
use crate::types::CallContext;
use crate::types::Status;
use crate::types::Value;

impl<X> Runtime<X> {
    pub(super) fn create_{{ data.name }}_constructor(&mut self) -> ObjectHandle {
        logger::debug!(event = "create_{{ data.name }}_constructor");
        debug_assert!(self.{{ data.name }}_prototype.is_some());
        let constructor = self.create_builtin_function(constructor::<X>, self.{{ data.name }}_prototype);
        if let Some(mut prototype) = self.{{ data.name }}_prototype {
            let _ = prototype.define_own_property(
                Symbol::CONSTRUCTOR.into(),
                Property::data_xxx(Value::Function(constructor)),
            );
        }
        constructor
    }

    pub(super) fn create_{{ data.name }}_prototype(&mut self) -> ObjectHandle {
        logger::debug!(event = "creater_{{ data.name }}_prototype");
        debug_assert!(self.error_prototype.is_some());

        use jsparser::symbol::builtin::names;
        const NAME: U16Chunk = U16Chunk::new_const(names::{{ data.name | upper }});

        let mut prototype = self.create_object(self.error_prototype);
        let _ = prototype.define_own_property(
            Symbol::MESSAGE.into(),
            Property::data_xxx(Value::String(U16String::EMPTY)),
        );
        let _ = prototype.define_own_property(
            Symbol::NAME.into(),
            Property::data_xxx(Value::String(U16String::new(&NAME))),
        );

        prototype
    }

    pub(crate) fn create_{{ data.name }}(&mut self, args: &[Value], new: bool) -> Result<Value, Value> {
        logger::debug!(event = "create_{{ data.name }}", ?args, new);
        // TODO(feat): NewTarget
        let object = self.create_object(self.{{ data.name }}_prototype);
        Ok(Value::Object(object))
    }
}

// lambda functions

extern "C" fn constructor<X>(
    runtime: &mut Runtime<X>,
    context: &mut CallContext,
    retv: &mut Value,
) -> Status {
    let args = context.args();
    let new = context.is_new();
    match runtime.create_{{ data.name }}(args, new) {
        Ok(value) => {
            *retv = value;
            Status::Normal
        }
        Err(value) => {
            *retv = value;
            Status::Exception
        }
    }
}
